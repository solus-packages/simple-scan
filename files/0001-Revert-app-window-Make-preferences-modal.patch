From 6cc75aca5a577c935c16f6d2d4e0af06c6815367 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Fri, 16 Apr 2021 01:48:17 +0300
Subject: [PATCH 1/1] Revert "app-window: Make preferences modal"

This reverts commit 4c58594801835b8e83681edd8c9376b1fc32634c.
---
 data/ui/app-window.ui         | 398 ++++++++++++----------
 data/ui/preferences-dialog.ui | 601 +++++++++++++++++++++++++---------
 meson.build                   |  27 --
 src/app-window.vala           |  42 ++-
 src/meson.build               |   2 +-
 src/preferences-dialog.vala   |   4 +-
 src/simple-scan.vala          |   2 -
 subprojects/libhandy.wrap     |   4 -
 9 files changed, 687 insertions(+), 399 deletions(-)
 delete mode 100644 subprojects/libhandy.wrap

diff --git a/data/ui/app-window.ui b/data/ui/app-window.ui
index 5fd0a0a..540c6bc 100644
--- a/data/ui/app-window.ui
+++ b/data/ui/app-window.ui
@@ -491,267 +491,308 @@
       </object>
     </child>
   </object>
-  <template class="AppWindow" parent="HdyApplicationWindow">
+  <template class="AppWindow" parent="GtkApplicationWindow">
     <property name="width_request">320</property>
     <property name="height_request">480</property>
     <property name="can_focus">False</property>
     <property name="title" translatable="yes" comments="Title of scan window">Document Scanner</property>
     <property name="icon_name">org.gnome.SimpleScan</property>
     <signal name="delete-event" handler="window_delete_event_cb" swapped="no"/>
-    <child>
-      <object class="GtkBox">
+    <child type="titlebar">
+      <object class="GtkHeaderBar" id="header_bar">
         <property name="visible">True</property>
         <property name="can_focus">False</property>
-        <property name="orientation">vertical</property>
+        <property name="vexpand">True</property>
+        <property name="show_close_button">True</property>
         <child>
-          <object class="HdyHeaderBar" id="header_bar">
+          <object class="GtkBox" id="open_box">
             <property name="visible">True</property>
             <property name="can_focus">False</property>
-            <property name="show_close_button">True</property>
+            <property name="valign">center</property>
             <child>
-              <object class="GtkBox" id="open_box">
-                <property name="visible">True</property>
+              <object class="GtkButton" id="stop_button">
                 <property name="can_focus">False</property>
-                <property name="valign">center</property>
-                <child>
-                  <object class="GtkButton" id="stop_button">
-                    <property name="can_focus">False</property>
-                    <property name="receives_default">False</property>
-                    <property name="tooltip_text" translatable="yes" comments="Tooltip for stop button">Stop the current scan</property>
-                    <property name="use_underline">True</property>
-                    <signal name="clicked" handler="stop_scan_button_clicked_cb" swapped="no"/>
-                    <child>
-                      <object class="GtkBox">
-                        <property name="visible">True</property>
-                        <property name="can_focus">False</property>
-                        <property name="spacing">6</property>
-                        <child>
-                          <object class="GtkSpinner" id="stop_button_spinner">
-                            <property name="visible">True</property>
-                            <property name="can_focus">False</property>
-                            <property name="active">True</property>
-                          </object>
-                          <packing>
-                            <property name="expand">False</property>
-                            <property name="fill">True</property>
-                            <property name="position">0</property>
-                          </packing>
-                        </child>
-                        <child>
-                          <object class="GtkLabel">
-                            <property name="visible">True</property>
-                            <property name="can_focus">False</property>
-                            <property name="label" translatable="yes">S_top</property>
-                            <property name="use_underline">True</property>
-                            <property name="width_chars">6</property>
-                            <property name="xalign">0.33</property>
-                          </object>
-                          <packing>
-                            <property name="expand">False</property>
-                            <property name="fill">True</property>
-                            <property name="position">1</property>
-                          </packing>
-                        </child>
-                      </object>
-                    </child>
-                    <style>
-                      <class name="text-button"/>
-                      <class name="destructive-action"/>
-                    </style>
-                  </object>
-                  <packing>
-                    <property name="expand">False</property>
-                    <property name="fill">True</property>
-                    <property name="position">0</property>
-                  </packing>
-                </child>
+                <property name="receives_default">False</property>
+                <property name="tooltip_text" translatable="yes" comments="Tooltip for stop button">Stop the current scan</property>
+                <property name="use_underline">True</property>
+                <signal name="clicked" handler="stop_scan_button_clicked_cb" swapped="no"/>
                 <child>
-                  <object class="GtkButton" id="scan_button">
+                  <object class="GtkBox">
                     <property name="visible">True</property>
-                    <property name="sensitive">False</property>
                     <property name="can_focus">False</property>
-                    <property name="receives_default">False</property>
-                    <property name="tooltip_text" translatable="yes" comments="Tooltip for scan toolbar button">Scan a single page from the scanner</property>
-                    <property name="use_underline">True</property>
-                    <signal name="clicked" handler="scan_button_clicked_cb" swapped="no"/>
+                    <property name="spacing">6</property>
                     <child>
-                      <object class="GtkBox">
+                      <object class="GtkSpinner" id="stop_button_spinner">
                         <property name="visible">True</property>
                         <property name="can_focus">False</property>
-                        <property name="spacing">6</property>
-                        <child>
-                          <object class="GtkImage" id="scan_options_image">
-                            <property name="visible">True</property>
-                            <property name="can_focus">False</property>
-                            <property name="icon_name">scanner-symbolic</property>
-                          </object>
-                          <packing>
-                            <property name="expand">False</property>
-                            <property name="fill">True</property>
-                            <property name="position">0</property>
-                          </packing>
-                        </child>
-                        <child>
-                          <object class="GtkLabel">
-                            <property name="visible">True</property>
-                            <property name="can_focus">False</property>
-                            <property name="margin_right">1</property>
-                            <property name="label" translatable="yes">_Scan</property>
-                            <property name="use_underline">True</property>
-                            <property name="width_chars">6</property>
-                            <property name="xalign">0.33</property>
-                          </object>
-                          <packing>
-                            <property name="expand">False</property>
-                            <property name="fill">True</property>
-                            <property name="position">1</property>
-                          </packing>
-                        </child>
+                        <property name="active">True</property>
                       </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">0</property>
+                      </packing>
                     </child>
-                    <style>
-                      <class name="text-button"/>
-                      <class name="suggested-action"/>
-                    </style>
-                  </object>
-                  <packing>
-                    <property name="expand">False</property>
-                    <property name="fill">True</property>
-                    <property name="position">1</property>
-                  </packing>
-                </child>
-                <child>
-                  <object class="GtkMenuButton">
-                    <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="receives_default">False</property>
-                    <property name="popover">scan_options_popover</property>
                     <child>
-                      <object class="GtkBox">
+                      <object class="GtkLabel">
                         <property name="visible">True</property>
                         <property name="can_focus">False</property>
-                        <property name="spacing">6</property>
-                        <child>
-                          <object class="GtkImage" id="scan_hint_image">
-                            <property name="visible">True</property>
-                            <property name="can_focus">False</property>
-                            <property name="icon_name">x-office-document-symbolic</property>
-                          </object>
-                          <packing>
-                            <property name="expand">False</property>
-                            <property name="fill">True</property>
-                            <property name="position">0</property>
-                          </packing>
-                        </child>
-                        <child>
-                          <object class="GtkImage">
-                            <property name="visible">True</property>
-                            <property name="can_focus">False</property>
-                            <property name="icon_name">pan-down-symbolic</property>
-                          </object>
-                          <packing>
-                            <property name="expand">False</property>
-                            <property name="fill">True</property>
-                            <property name="position">1</property>
-                          </packing>
-                        </child>
+                        <property name="label" translatable="yes">S_top</property>
+                        <property name="use_underline">True</property>
+                        <property name="width_chars">6</property>
+                        <property name="xalign">0.33</property>
                       </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">1</property>
+                      </packing>
                     </child>
                   </object>
-                  <packing>
-                    <property name="expand">False</property>
-                    <property name="fill">True</property>
-                    <property name="position">2</property>
-                  </packing>
                 </child>
                 <style>
-                  <class name="linked"/>
+                  <class name="text-button"/>
+                  <class name="destructive-action"/>
                 </style>
               </object>
+              <packing>
+                <property name="expand">False</property>
+                <property name="fill">True</property>
+                <property name="position">0</property>
+              </packing>
             </child>
             <child>
-              <object class="GtkMenuButton" id="menu_button">
+              <object class="GtkButton" id="scan_button">
                 <property name="visible">True</property>
+                <property name="sensitive">False</property>
                 <property name="can_focus">False</property>
                 <property name="receives_default">False</property>
+                <property name="tooltip_text" translatable="yes" comments="Tooltip for scan toolbar button">Scan a single page from the scanner</property>
                 <property name="use_underline">True</property>
-                <accelerator key="F10" signal="activate"/>
+                <signal name="clicked" handler="scan_button_clicked_cb" swapped="no"/>
                 <child>
-                  <object class="GtkImage">
+                  <object class="GtkBox">
                     <property name="visible">True</property>
                     <property name="can_focus">False</property>
-                    <property name="icon_name">open-menu-symbolic</property>
-                    <property name="icon_size">1</property>
+                    <property name="spacing">6</property>
+                    <child>
+                      <object class="GtkImage" id="scan_options_image">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="icon_name">scanner-symbolic</property>
+                      </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkLabel">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="margin_right">1</property>
+                        <property name="label" translatable="yes">_Scan</property>
+                        <property name="use_underline">True</property>
+                        <property name="width_chars">6</property>
+                        <property name="xalign">0.33</property>
+                      </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
                   </object>
                 </child>
                 <style>
-                  <class name="image-button"/>
+                  <class name="text-button"/>
+                  <class name="suggested-action"/>
                 </style>
               </object>
               <packing>
-                <property name="pack_type">end</property>
+                <property name="expand">False</property>
+                <property name="fill">True</property>
                 <property name="position">1</property>
               </packing>
             </child>
             <child>
-              <object class="GtkButton" id="save_button">
+              <object class="GtkMenuButton">
                 <property name="visible">True</property>
-                <property name="sensitive">False</property>
                 <property name="can_focus">False</property>
                 <property name="receives_default">False</property>
-                <property name="tooltip_text" translatable="yes" comments="Tooltip for save toolbar button">Save document to a file</property>
-                <property name="use_underline">True</property>
-                <signal name="clicked" handler="save_file_button_clicked_cb" swapped="no"/>
+                <property name="popover">scan_options_popover</property>
                 <child>
-                  <object class="GtkImage" id="save_image">
+                  <object class="GtkBox">
                     <property name="visible">True</property>
                     <property name="can_focus">False</property>
-                    <property name="icon_name">document-save-symbolic</property>
-                    <property name="icon_size">1</property>
+                    <property name="spacing">6</property>
+                    <child>
+                      <object class="GtkImage" id="scan_hint_image">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="icon_name">x-office-document-symbolic</property>
+                      </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkImage">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="icon_name">pan-down-symbolic</property>
+                      </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
                   </object>
                 </child>
-                <style>
-                  <class name="image-button"/>
-                </style>
               </object>
               <packing>
-                <property name="pack_type">end</property>
+                <property name="expand">False</property>
+                <property name="fill">True</property>
                 <property name="position">2</property>
               </packing>
             </child>
             <style>
-              <class name="titlebar"/>
+              <class name="linked"/>
+            </style>
+          </object>
+        </child>
+        <child>
+          <object class="GtkMenuButton" id="menu_button">
+            <property name="visible">True</property>
+            <property name="can_focus">False</property>
+            <property name="receives_default">False</property>
+            <property name="use_underline">True</property>
+            <accelerator key="F10" signal="activate"/>
+            <child>
+              <object class="GtkImage">
+                <property name="visible">True</property>
+                <property name="can_focus">False</property>
+                <property name="icon_name">open-menu-symbolic</property>
+                <property name="icon_size">1</property>
+              </object>
+            </child>
+            <style>
+              <class name="image-button"/>
+            </style>
+          </object>
+          <packing>
+            <property name="pack_type">end</property>
+            <property name="position">1</property>
+          </packing>
+        </child>
+        <child>
+          <object class="GtkButton" id="save_button">
+            <property name="visible">True</property>
+            <property name="sensitive">False</property>
+            <property name="can_focus">False</property>
+            <property name="receives_default">False</property>
+            <property name="tooltip_text" translatable="yes" comments="Tooltip for save toolbar button">Save document to a file</property>
+            <property name="use_underline">True</property>
+            <signal name="clicked" handler="save_file_button_clicked_cb" swapped="no"/>
+            <child>
+              <object class="GtkImage" id="save_image">
+                <property name="visible">True</property>
+                <property name="can_focus">False</property>
+                <property name="icon_name">document-save-symbolic</property>
+                <property name="icon_size">1</property>
+              </object>
+            </child>
+            <style>
+              <class name="image-button"/>
             </style>
           </object>
+          <packing>
+            <property name="pack_type">end</property>
+            <property name="position">2</property>
+          </packing>
         </child>
+        <style>
+          <class name="titlebar"/>
+        </style>
+      </object>
+    </child>
+    <child>
+      <object class="GtkBox">
+        <property name="visible">True</property>
+        <property name="can_focus">False</property>
+        <property name="orientation">vertical</property>
         <child>
           <object class="GtkStack" id="stack">
             <property name="visible">True</property>
             <property name="can_focus">False</property>
             <property name="vexpand">True</property>
             <child>
-              <object class="HdyStatusPage" id="status_page">
+              <object class="GtkAlignment">
                 <property name="visible">True</property>
-                <property name="icon_name">org.gnome.SimpleScan-symbolic</property>
+                <property name="can_focus">False</property>
+                <property name="xscale">0</property>
+                <property name="yscale">0</property>
                 <child>
                   <object class="GtkBox">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="orientation">vertical</property>
-                    <property name="spacing">12</property>
+                    <property name="spacing">10</property>
+                    <child>
+                      <object class="GtkImage">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="has_focus">True</property>
+                        <property name="is_focus">True</property>
+                        <property name="can_default">True</property>
+                        <property name="has_default">True</property>
+                        <property name="opacity">0.5</property>
+                        <property name="pixel_size">120</property>
+                        <property name="icon_name">org.gnome.SimpleScan-symbolic</property>
+                        <property name="icon_size">6</property>
+                      </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkLabel" id="status_primary_label">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <attributes>
+                          <attribute name="weight" value="bold"/>
+                          <attribute name="scale" value="1.5"/>
+                        </attributes>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
+                      </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
                     <child>
                       <object class="GtkLabel" id="status_secondary_label">
-                        <property name="visible">False</property>
-                        <property name="wrap">True</property>
-                        <property name="wrap-mode">word-char</property>
-                        <property name="justify">center</property>
-                        <property name="use-markup">True</property>
+                        <property name="can_focus">False</property>
                         <property name="track_visited_links">False</property>
                         <signal name="activate-link" handler="status_label_activate_link_cb" swapped="no"/>
                         <style>
-                          <class name="body"/>
-                          <class name="description"/>
+                          <class name="dim-label"/>
                         </style>
                       </object>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">True</property>
+                        <property name="position">2</property>
+                      </packing>
                     </child>
                     <child>
                       <object class="GtkBox" id="device_buttons_box">
@@ -827,6 +868,11 @@
               </packing>
             </child>
           </object>
+          <packing>
+            <property name="expand">False</property>
+            <property name="fill">True</property>
+            <property name="position">0</property>
+          </packing>
         </child>
       </object>
     </child>
diff --git a/data/ui/preferences-dialog.ui b/data/ui/preferences-dialog.ui
index a54709c..8bd7999 100644
--- a/data/ui/preferences-dialog.ui
+++ b/data/ui/preferences-dialog.ui
@@ -40,243 +40,520 @@
       <column type="gchararray"/>
     </columns>
   </object>
-  <template class="PreferencesDialog" parent="HdyPreferencesWindow">
+  <template class="PreferencesDialog" parent="GtkDialog">
     <property name="can_focus">False</property>
+    <property name="title" translatable="yes" comments="Title of preferences dialog">Preferences</property>
+    <property name="resizable">False</property>
     <property name="icon_name">org.gnome.SimpleScan</property>
-    <property name="search_enabled">False</property>
-    <child>
-      <object class="HdyPreferencesPage">
+    <property name="type_hint">normal</property>
+    <child type="titlebar">
+      <placeholder/>
+    </child>
+    <child internal-child="vbox">
+      <object class="GtkBox" id="dialog-vbox2">
         <property name="visible">True</property>
+        <property name="can_focus">False</property>
+        <property name="orientation">vertical</property>
+        <property name="spacing">2</property>
+        <child internal-child="action_area">
+          <object class="GtkButtonBox">
+            <property name="can_focus">False</property>
+          </object>
+          <packing>
+            <property name="expand">False</property>
+            <property name="fill">False</property>
+            <property name="position">0</property>
+          </packing>
+        </child>
         <child>
-          <object class="HdyPreferencesGroup">
+          <object class="GtkNotebook">
             <property name="visible">True</property>
-            <property name="title" translatable="yes" comments="Preferences Dialog: Section label for scanning settings">Scanning</property>
+            <property name="can_focus">True</property>
+            <property name="show_border">False</property>
             <child>
-              <object class="HdyActionRow">
+              <object class="GtkBox">
                 <property name="visible">True</property>
-                <property name="title" translatable="yes" comments="Label beside scan side combo box">Scan _Sides</property>
-                <property name="use_underline">True</property>
-                <property name="activatable_widget">front_side_button</property>
+                <property name="can_focus">False</property>
+                <property name="border_width">30</property>
+                <property name="orientation">vertical</property>
+                <property name="spacing">30</property>
                 <child>
-                  <object class="GtkBox" id="scan_side_box">
+                  <object class="GtkGrid">
                     <property name="visible">True</property>
                     <property name="can_focus">False</property>
-                    <property name="valign">center</property>
-                    <property name="homogeneous">True</property>
+                    <property name="row_spacing">15</property>
+                    <property name="column_spacing">10</property>
                     <child>
-                      <object class="GtkRadioButton" id="front_side_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">Front</property>
+                      <object class="GtkLabel" id="page_side_label">
                         <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="active">True</property>
-                        <property name="draw_indicator">False</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label beside scan side combo box">Scan _Sides</property>
+                        <property name="use_underline">True</property>
+                        <property name="mnemonic_widget">front_side_button</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
                       </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">0</property>
+                      </packing>
                     </child>
                     <child>
-                      <object class="GtkRadioButton" id="back_side_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on the back side of a page">Back</property>
+                      <object class="GtkLabel" id="paper_size_label">
                         <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="draw_indicator">False</property>
-                        <property name="group">front_side_button</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label beside page size combo box">_Page Size</property>
+                        <property name="use_underline">True</property>
+                        <property name="mnemonic_widget">paper_size_combo</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
                       </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">1</property>
+                      </packing>
                     </child>
                     <child>
-                      <object class="GtkRadioButton" id="both_side_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on both sides of a page">Both</property>
+                      <object class="GtkComboBox" id="paper_size_combo">
                         <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="draw_indicator">False</property>
-                        <property name="group">front_side_button</property>
+                        <property name="can_focus">False</property>
+                        <property name="hexpand">True</property>
+                        <property name="model">paper_size_model</property>
                       </object>
+                      <packing>
+                        <property name="left_attach">1</property>
+                        <property name="top_attach">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkBox" id="scan_side_box">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="homogeneous">True</property>
+                        <child>
+                          <object class="GtkRadioButton" id="front_side_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">Front</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="active">True</property>
+                            <property name="draw_indicator">False</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">0</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkRadioButton" id="back_side_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on the back side of a page">Back</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="draw_indicator">False</property>
+                            <property name="group">front_side_button</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkRadioButton" id="both_side_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on both sides of a page">Both</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="draw_indicator">False</property>
+                            <property name="group">front_side_button</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">2</property>
+                          </packing>
+                        </child>
+                        <style>
+                          <class name="linked"/>
+                        </style>
+                      </object>
+                      <packing>
+                        <property name="left_attach">1</property>
+                        <property name="top_attach">0</property>
+                      </packing>
                     </child>
-                    <style>
-                      <class name="linked"/>
-                    </style>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="title" translatable="yes" comments="Label beside page size combo box">_Page Size</property>
-                <property name="use_underline">True</property>
-                <property name="activatable_widget">paper_size_combo</property>
-                <child>
-                  <object class="GtkComboBox" id="paper_size_combo">
-                    <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="hexpand">True</property>
-                    <property name="valign">center</property>
-                    <property name="model">paper_size_model</property>
                   </object>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">True</property>
+                    <property name="position">0</property>
+                  </packing>
                 </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="title" translatable="yes" comments="Label beside page delay scale">_Delay in Seconds</property>
-                <property name="subtitle" translatable="yes" comments="Provides context for the page delay scale">Interval to scan multiple pages</property>
-                <property name="use_underline">True</property>
-                <property name="activatable_widget">page_delay_0s_button</property>
                 <child>
-                  <object class="GtkBox">
+                  <object class="GtkGrid">
                     <property name="visible">True</property>
                     <property name="can_focus">False</property>
-                    <property name="valign">center</property>
-                    <property name="homogeneous">True</property>
-                    <child>
-                      <object class="GtkRadioButton" id="page_delay_0s_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">0</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="active">True</property>
-                        <property name="draw_indicator">False</property>
-                      </object>
-                    </child>
+                    <property name="row_spacing">15</property>
+                    <property name="column_spacing">10</property>
                     <child>
-                      <object class="GtkRadioButton" id="page_delay_3s_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">3</property>
+                      <object class="GtkLabel" id="page_delay_label">
                         <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="active">True</property>
-                        <property name="draw_indicator">False</property>
-                        <property name="group">page_delay_0s_button</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label beside page delay scale">_Delay</property>
+                        <property name="use_underline">True</property>
+                        <property name="mnemonic_widget">page_delay_0s_button</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
                       </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">1</property>
+                      </packing>
                     </child>
                     <child>
-                      <object class="GtkRadioButton" id="page_delay_6s_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">6</property>
+                      <object class="GtkLabel">
                         <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="active">True</property>
-                        <property name="draw_indicator">False</property>
-                        <property name="group">page_delay_0s_button</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Preferences dialog: Label above settings for scanning multiple pages from a flatbed">Multiple pages from flatbed</property>
+                        <property name="xalign">0</property>
+                        <attributes>
+                          <attribute name="weight" value="bold"/>
+                        </attributes>
                       </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">0</property>
+                        <property name="width">3</property>
+                      </packing>
                     </child>
                     <child>
-                      <object class="GtkRadioButton" id="page_delay_10s_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">10</property>
+                      <object class="GtkBox">
                         <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="active">True</property>
-                        <property name="draw_indicator">False</property>
-                        <property name="group">page_delay_0s_button</property>
+                        <property name="can_focus">False</property>
+                        <property name="homogeneous">True</property>
+                        <child>
+                          <object class="GtkRadioButton" id="page_delay_0s_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">0</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="active">True</property>
+                            <property name="draw_indicator">False</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">0</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkRadioButton" id="page_delay_3s_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">3</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="active">True</property>
+                            <property name="draw_indicator">False</property>
+                            <property name="group">page_delay_0s_button</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkRadioButton" id="page_delay_6s_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">6</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="active">True</property>
+                            <property name="draw_indicator">False</property>
+                            <property name="group">page_delay_0s_button</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">2</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkRadioButton" id="page_delay_10s_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">10</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="active">True</property>
+                            <property name="draw_indicator">False</property>
+                            <property name="group">page_delay_0s_button</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">3</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <object class="GtkRadioButton" id="page_delay_15s_button">
+                            <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">15</property>
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="receives_default">True</property>
+                            <property name="active">True</property>
+                            <property name="draw_indicator">False</property>
+                            <property name="group">page_delay_0s_button</property>
+                          </object>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">True</property>
+                            <property name="position">4</property>
+                          </packing>
+                        </child>
+                        <style>
+                          <class name="linked"/>
+                        </style>
                       </object>
+                      <packing>
+                        <property name="left_attach">1</property>
+                        <property name="top_attach">1</property>
+                      </packing>
                     </child>
                     <child>
-                      <object class="GtkRadioButton" id="page_delay_15s_button">
-                        <property name="label" translatable="yes" comments="Preferences Dialog: Toggle button to select scanning on front side of a page">15</property>
+                      <object class="GtkLabel">
                         <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">True</property>
-                        <property name="active">True</property>
-                        <property name="draw_indicator">False</property>
-                        <property name="group">page_delay_0s_button</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label after page delay radio buttons">Seconds</property>
+                        <property name="use_underline">True</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
                       </object>
+                      <packing>
+                        <property name="left_attach">2</property>
+                        <property name="top_attach">1</property>
+                      </packing>
                     </child>
-                    <style>
-                      <class name="linked"/>
-                    </style>
                   </object>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">True</property>
+                    <property name="position">1</property>
+                  </packing>
                 </child>
               </object>
+              <packing>
+                <property name="tab_expand">True</property>
+              </packing>
             </child>
-          </object>
-        </child>
-        <child>
-          <object class="HdyPreferencesGroup">
-            <property name="visible">True</property>
-            <property name="title" translatable="yes" comments="Preferences Dialog: Section label for quality settings">Quality</property>
-            <child>
-              <object class="HdyActionRow">
+            <child type="tab">
+              <object class="GtkLabel">
                 <property name="visible">True</property>
-                <property name="title" translatable="yes" comments="Label beside scan resolution combo box">_Text Resolution</property>
+                <property name="can_focus">False</property>
+                <property name="label" translatable="yes" comments="Preferences Dialog: Tab label for scanning settings">_Scanning</property>
                 <property name="use_underline">True</property>
-                <property name="activatable_widget">text_dpi_combo</property>
-                <child>
-                  <object class="GtkComboBox" id="text_dpi_combo">
-                    <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="valign">center</property>
-                    <property name="model">text_dpi_model</property>
-                  </object>
-                </child>
               </object>
+              <packing>
+                <property name="tab_fill">False</property>
+              </packing>
             </child>
             <child>
-              <object class="HdyActionRow">
+              <object class="GtkBox">
                 <property name="visible">True</property>
-                <property name="title" translatable="yes" comments="Label beside scan resolution combo box">_Image Resolution</property>
-                <property name="use_underline">True</property>
-                <property name="activatable_widget">photo_dpi_combo</property>
+                <property name="can_focus">False</property>
+                <property name="border_width">30</property>
+                <property name="orientation">vertical</property>
+                <property name="spacing">30</property>
                 <child>
-                  <object class="GtkComboBox" id="photo_dpi_combo">
+                  <object class="GtkGrid">
                     <property name="visible">True</property>
                     <property name="can_focus">False</property>
-                    <property name="valign">center</property>
-                    <property name="model">photo_dpi_model</property>
+                    <property name="row_spacing">14</property>
+                    <property name="column_spacing">10</property>
+                    <child>
+                      <object class="GtkLabel" id="text_dpi_label">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label beside scan resolution combo box">_Text Resolution</property>
+                        <property name="use_underline">True</property>
+                        <property name="mnemonic_widget">text_dpi_combo</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkLabel" id="photo_dpi_label">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label beside scan resolution combo box">_Image Resolution</property>
+                        <property name="use_underline">True</property>
+                        <property name="mnemonic_widget">photo_dpi_combo</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkComboBox" id="text_dpi_combo">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="hexpand">True</property>
+                        <property name="model">text_dpi_model</property>
+                      </object>
+                      <packing>
+                        <property name="left_attach">1</property>
+                        <property name="top_attach">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkComboBox" id="photo_dpi_combo">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="hexpand">True</property>
+                        <property name="model">photo_dpi_model</property>
+                      </object>
+                      <packing>
+                        <property name="left_attach">1</property>
+                        <property name="top_attach">1</property>
+                      </packing>
+                    </child>
                   </object>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">True</property>
+                    <property name="position">0</property>
+                  </packing>
                 </child>
-              </object>
-            </child>
-            <child>
-              <object class="HdyActionRow">
-                <property name="visible">True</property>
-                <property name="can_focus">False</property>
-                <property name="title" translatable="yes" comments="Label beside brightness scale">_Brightness</property>
-                <property name="use_underline">True</property>
-                <property name="activatable_widget">brightness_scale</property>
                 <child>
-                  <object class="GtkScale" id="brightness_scale">
+                  <object class="GtkGrid">
                     <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="valign">center</property>
-                    <property name="hexpand">True</property>
-                    <property name="adjustment">brightness_adjustment</property>
-                    <property name="draw_value">False</property>
+                    <property name="can_focus">False</property>
+                    <property name="row_spacing">15</property>
+                    <property name="column_spacing">10</property>
+                    <child>
+                      <object class="GtkLabel" id="brightness_label">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label beside brightness scale">_Brightness</property>
+                        <property name="use_underline">True</property>
+                        <property name="mnemonic_widget">brightness_scale</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkLabel" id="contrast_label">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes" comments="Label beside contrast scale">_Contrast</property>
+                        <property name="use_underline">True</property>
+                        <property name="mnemonic_widget">contrast_scale</property>
+                        <property name="xalign">1</property>
+                        <style>
+                          <class name="dim-label"/>
+                        </style>
+                      </object>
+                      <packing>
+                        <property name="left_attach">0</property>
+                        <property name="top_attach">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkScale" id="brightness_scale">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="hexpand">True</property>
+                        <property name="adjustment">brightness_adjustment</property>
+                        <property name="draw_value">False</property>
+                      </object>
+                      <packing>
+                        <property name="left_attach">1</property>
+                        <property name="top_attach">0</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <object class="GtkScale" id="contrast_scale">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="hexpand">True</property>
+                        <property name="adjustment">contrast_adjustment</property>
+                        <property name="draw_value">False</property>
+                      </object>
+                      <packing>
+                        <property name="left_attach">1</property>
+                        <property name="top_attach">1</property>
+                      </packing>
+                    </child>
                   </object>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">True</property>
+                    <property name="position">1</property>
+                  </packing>
                 </child>
               </object>
+              <packing>
+                <property name="position">1</property>
+                <property name="tab_expand">True</property>
+              </packing>
             </child>
-            <child>
-              <object class="HdyActionRow">
+            <child type="tab">
+              <object class="GtkLabel">
                 <property name="visible">True</property>
                 <property name="can_focus">False</property>
-                <property name="title" translatable="yes" comments="Label beside contrast scale">_Contrast</property>
+                <property name="label" translatable="yes" comments="Preferences Dialog: Tab for quality settings">_Quality</property>
                 <property name="use_underline">True</property>
-                <property name="activatable_widget">contrast_scale</property>
-                <child>
-                  <object class="GtkScale" id="contrast_scale">
-                    <property name="visible">True</property>
-                    <property name="can_focus">True</property>
-                    <property name="valign">center</property>
-                    <property name="hexpand">True</property>
-                    <property name="adjustment">contrast_adjustment</property>
-                    <property name="draw_value">False</property>
-                  </object>
-                </child>
               </object>
+              <packing>
+                <property name="position">1</property>
+                <property name="tab_fill">False</property>
+              </packing>
             </child>
           </object>
+          <packing>
+            <property name="expand">False</property>
+            <property name="fill">True</property>
+            <property name="position">1</property>
+          </packing>
         </child>
       </object>
     </child>
   </template>
-  <object class="GtkSizeGroup" id="scale_size_group">
-    <property name="mode">GTK_SIZE_GROUP_HORIZONTAL</property>
+  <object class="GtkSizeGroup" id="label_size_group">
     <widgets>
-      <widget name="brightness_scale"/>
-      <widget name="contrast_scale"/>
+      <widget name="page_side_label"/>
+      <widget name="paper_size_label"/>
+      <widget name="page_delay_label"/>
+      <widget name="text_dpi_label"/>
+      <widget name="photo_dpi_label"/>
+      <widget name="brightness_label"/>
+      <widget name="contrast_label"/>
     </widgets>
   </object>
 </interface>
diff --git a/meson.build b/meson.build
index 1e1522c..a483df3 100644
--- a/meson.build
+++ b/meson.build
@@ -7,12 +7,6 @@ project ('simple-scan', ['vala', 'c'],
          ],
          meson_version: '>= 0.37.1')
 
-# FIXME Disable --disable-since-check after libhandy 1.2 is released
-add_project_arguments (
-  '--disable-since-check',
-  language: 'vala'
-)
-
 gnome = import ('gnome')
 i18n = import ('i18n')
 
@@ -29,7 +23,6 @@ glib_dep = dependency ('glib-2.0', version: '>= 2.38')
 gtk_dep = dependency ('gtk+-3.0', version: '>=3.22')
 gmodule_dep = dependency ('gmodule-export-2.0')
 gthread_dep = dependency ('gthread-2.0')
-libhandy_dep = dependency ('libhandy-1', version: '>= 1.1.90', required: false)
 zlib_dep = dependency ('zlib')
 cairo_dep = dependency ('cairo')
 gdk_pixbuf_dep = dependency ('gdk-pixbuf-2.0')
@@ -42,26 +35,6 @@ sane_dep = dependency ('sane-backends')
 msgfmt = find_program  ('msgfmt')
 itstool = find_program  ('itstool')
 
-libhandy_subproj = libhandy_dep
-if not libhandy_dep.found()
-  libhandy_subproj = subproject(
-    'libhandy',
-    default_options: [
-      'examples=false',
-      'glade_catalog=disabled',
-      'tests=false',
-    ]
-  )
-
-  # When using libhandy as subproject, make sure we get the VAPI file
-  libhandy_dep = declare_dependency(
-    dependencies: [
-      libhandy_subproj.get_variable('libhandy_dep'),
-      libhandy_subproj.get_variable('libhandy_vapi'),
-    ]
-  )
-endif
-
 subdir ('po')
 subdir ('data')
 subdir ('help')
diff --git a/src/app-window.vala b/src/app-window.vala
index c4d0cb8..ec151be 100644
--- a/src/app-window.vala
+++ b/src/app-window.vala
@@ -14,7 +14,7 @@ private const int DEFAULT_TEXT_DPI = 150;
 private const int DEFAULT_PHOTO_DPI = 300;
 
 [GtkTemplate (ui = "/org/gnome/SimpleScan/ui/app-window.ui")]
-public class AppWindow : Hdy.ApplicationWindow
+public class AppWindow : Gtk.ApplicationWindow
 {
     private const GLib.ActionEntry[] action_entries =
     {
@@ -48,15 +48,13 @@ public class AppWindow : Hdy.ApplicationWindow
     private bool user_selected_device;
 
     [GtkChild]
-    private unowned Hdy.HeaderBar header_bar;
+    private Gtk.HeaderBar header_bar;
     [GtkChild]
     private unowned Gtk.Menu page_menu;
     [GtkChild]
     private unowned Gtk.Stack stack;
     [GtkChild]
-    private unowned Hdy.StatusPage status_page;
-    [GtkChild]
-    private unowned Gtk.Label status_secondary_label;
+    private Gtk.Label status_primary_label;
     [GtkChild]
     private unowned Gtk.ListStore device_model;
     [GtkChild]
@@ -64,7 +62,9 @@ public class AppWindow : Hdy.ApplicationWindow
     [GtkChild]
     private unowned Gtk.ComboBox device_combo;
     [GtkChild]
-    private unowned Gtk.Box main_vbox;
+    private Gtk.Label status_secondary_label;
+    [GtkChild]
+    private Gtk.Box main_vbox;
     [GtkChild]
     private unowned Gtk.RadioMenuItem custom_crop_menuitem;
     [GtkChild]
@@ -251,16 +251,16 @@ public class AppWindow : Hdy.ApplicationWindow
         scan_button.sensitive = false;
         if (!have_devices)
         {
-            status_page.set_title (/* Label shown when searching for scanners */
-                                   _("Searching for Scanners…"));
+            status_primary_label.set_text (/* Label shown when searching for scanners */
+                                           _("Searching for Scanners…"));
             status_secondary_label.visible = false;
             device_buttons_box.visible = false;
         }
         else if (get_selected_device () != null)
         {
             scan_button.sensitive = true;
-            status_page.set_title (/* Label shown when detected a scanner */
-                                   _("Ready to Scan"));
+            status_primary_label.set_text (/* Label shown when detected a scanner */
+                                           _("Ready to Scan"));
             status_secondary_label.set_text (get_selected_device_label ());
             status_secondary_label.visible = false;
             device_buttons_box.visible = true;
@@ -269,8 +269,8 @@ public class AppWindow : Hdy.ApplicationWindow
         }
         else if (this.missing_driver != null)
         {
-            status_page.set_title (/* Warning displayed when no drivers are installed but a compatible scanner is detected */
-                                   _("Additional Software Needed"));
+            status_primary_label.set_text (/* Warning displayed when no drivers are installed but a compatible scanner is detected */
+                                           _("Additional software needed"));
             /* Instructions to install driver software */
             status_secondary_label.set_markup (_("You need to <a href=\"install-firmware\">install driver software</a> for your scanner."));
             status_secondary_label.visible = true;
@@ -279,9 +279,9 @@ public class AppWindow : Hdy.ApplicationWindow
         else
         {
             /* Warning displayed when no scanners are detected */
-            status_page.set_title (_("No Scanners Detected"));
+            status_primary_label.set_text (_("No scanners detected"));
             /* Hint to user on why there are no scanners detected */
-            status_secondary_label.set_text (_("Please check your scanner is connected and powered on."));
+            status_secondary_label.set_text (_("Please check your scanner is connected and powered on"));
             status_secondary_label.visible = true;
             device_buttons_box.visible = true;
             device_buttons_box.sensitive = true;
@@ -832,8 +832,8 @@ public class AppWindow : Hdy.ApplicationWindow
 
     private void scan (ScanOptions options)
     {
-        status_page.set_title (/* Label shown when scan started */
-                               _("Contacting Scanner…"));
+        status_primary_label.set_text (/* Label shown when scan started */
+                                       _("Contacting scanner…"));
         device_buttons_box.visible = true;
         device_buttons_box.sensitive = false;
         start_scan (get_selected_device (), options);
@@ -1845,12 +1845,8 @@ public class AppWindow : Hdy.ApplicationWindow
     private void load ()
     {
         preferences_dialog = new PreferencesDialog (settings);
-        preferences_dialog.delete_event.connect (() => {
-            preferences_dialog.visible = false;
-            return true;
-        });
-        preferences_dialog.transient_for = this;
-        preferences_dialog.modal = true;
+        preferences_dialog.delete_event.connect (() => { return true; });
+        preferences_dialog.response.connect (() => { preferences_dialog.visible = false; });
 
         Gtk.Window.set_default_icon_name ("org.gnome.SimpleScan");
 
@@ -1887,9 +1883,9 @@ public class AppWindow : Hdy.ApplicationWindow
         section.append (_("Email"), "app.email");
         section.append (_("Print"), "app.print");
         section.append (C_("menu", "Reorder Pages"), "app.reorder");
+        section.append (_("Preferences"), "app.preferences");
         section = new Menu ();
         gear_menu.append_section (null, section);
-        section.append (_("Preferences"), "app.preferences");
         section.append (_("Keyboard Shortcuts"), "win.show-help-overlay");
         section.append (_("Help"), "app.help");
         section.append (_("About Document Scanner"), "app.about");
diff --git a/src/meson.build b/src/meson.build
index 3f699eb..a2c5ade 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -1,5 +1,5 @@
 vala_args = [ '--pkg=posix', '--vapidir=' + meson.current_source_dir () ]
-dependencies = [ glib_dep, gtk_dep, libhandy_dep, zlib_dep, cairo_dep, gdk_pixbuf_dep, gusb_dep, sane_dep ]
+dependencies = [ glib_dep, gtk_dep, zlib_dep, cairo_dep, gdk_pixbuf_dep, gusb_dep, sane_dep ]
 if colord_dep.found ()
     vala_args += [ '-D', 'HAVE_COLORD' ]
     dependencies += colord_dep
diff --git a/src/preferences-dialog.vala b/src/preferences-dialog.vala
index e10e153..9e64b74 100644
--- a/src/preferences-dialog.vala
+++ b/src/preferences-dialog.vala
@@ -11,7 +11,7 @@
  */
 
 [GtkTemplate (ui = "/org/gnome/SimpleScan/ui/preferences-dialog.ui")]
-private class PreferencesDialog : Hdy.PreferencesWindow
+private class PreferencesDialog : Gtk.Dialog
 {
     private Settings settings;
 
@@ -54,6 +54,8 @@ private class PreferencesDialog : Hdy.PreferencesWindow
 
     public PreferencesDialog (Settings settings)
     {
+        Object (use_header_bar: 1);
+
         this.settings = settings;
 
         Gtk.TreeIter iter;
diff --git a/src/simple-scan.vala b/src/simple-scan.vala
index c15a541..84d8a8c 100644
--- a/src/simple-scan.vala
+++ b/src/simple-scan.vala
@@ -50,8 +50,6 @@ public class SimpleScan : Gtk.Application
     {
         base.startup ();
 
-        Hdy.init ();
-
         app = new AppWindow ();
         book = app.book;
         app.start_scan.connect (scan_cb);
diff --git a/subprojects/libhandy.wrap b/subprojects/libhandy.wrap
deleted file mode 100644
index a3806c8..0000000
--- a/subprojects/libhandy.wrap
+++ /dev/null
@@ -1,4 +0,0 @@
-[wrap-git]
-directory=libhandy
-url=https://gitlab.gnome.org/GNOME/libhandy.git
-revision=origin/master
-- 
2.30.2

